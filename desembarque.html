<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Buscar Empresa y Mostrar Datos</title>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #444;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #f2f2f2;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>Buscar Empresa</h1>
  <input type="text" id="busqueda" placeholder="Escribe el nombre de la empresa">
  <button id="btnBuscar">Buscar</button>
  <button id="btnMostrarTodas">Mostrar todas</button>

  <div id="resultado"></div>

  <h2>Datos desde JSON</h2>
  <table id="tabla-datos">
    <thead>
      <tr>
        <th>Empresa</th>
        <th>Origen</th>
        <th>Placa</th>
        <th>Fecha</th>
        <th id="thEntrada">Entrada</th>
        <th id="thSalida">Salida</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

<script>
  // Variable global para almacenar los datos
  let datosGlobales = [];

  // Cargar datos desde JSON al iniciar
  fetch('csvjson.json')
    .then(response => response.json())
    .then(data => {
      datosGlobales = data;
      mostrarDatosEnTabla(datosGlobales);
    })
    .catch(error => {
      console.error('Error al cargar csvjson.json:', error);
      alert('No se pudo cargar csvjson.json. Asegúrate de usar un servidor local o que el archivo esté en la ruta correcta.');
    });

  // Función para mostrar datos en la tabla
  function mostrarDatosEnTabla(datos) {
    const tbody = document.querySelector('#tabla-datos tbody');
    tbody.innerHTML = ''; // Limpiar tabla

    if(datos.length === 0){
      tbody.innerHTML = `<tr><td colspan="6" style="color: red;">No se encontraron registros.</td></tr>`;
      return;
    }

    datos.forEach(item => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${item.Empresa || ''}</td>
        <td>${item.Origen || ''}</td>
        <td>${item.Placa || ''}</td>
        <td>${item.Fecha || ''}</td>
        <td>${item.Entrada || ''}</td>
        <td>${item.Salida || ''}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Función para convertir "HH:MM" o "HH:MM:SS" a minutos o segundos para ordenar
  function parseHora(horaStr) {
    if (!horaStr) return 0;
    const partes = horaStr.split(':').map(Number);
    if (partes.length === 2) {
      return partes[0] * 60 + partes[1]; // minutos totales
    } else if (partes.length === 3) {
      return partes[0] * 3600 + partes[1] * 60 + partes[2]; // segundos totales
    }
    return 0;
  }

  // Botones y campo de búsqueda
  const btnBuscar = document.getElementById('btnBuscar');
  const btnMostrarTodas = document.getElementById('btnMostrarTodas');
  const inputBusqueda = document.getElementById('busqueda');
  const contenedorResultado = document.getElementById('resultado');

  // Evento para buscar empresa
  btnBuscar.addEventListener('click', () => {
    const nombre = inputBusqueda.value.trim().toUpperCase();

    let coincidencias = datosGlobales.filter(item =>
      String(item.Empresa || '').trim().toUpperCase().includes(nombre)
    );

    // Ordenar coincidencias por hora de Entrada (de menor a mayor)
    coincidencias.sort((a, b) => {
      const horaA = parseHora(a.Entrada);
      const horaB = parseHora(b.Entrada);
      return horaA - horaB;
    });

    if (coincidencias.length > 0) {
      contenedorResultado.innerHTML = ''; // Limpiar mensajes
      mostrarDatosEnTabla(coincidencias);
    } else {
      contenedorResultado.innerHTML = '<p style="color: red;">Empresa no encontrada.</p>';
      mostrarDatosEnTabla([]);
    }
  });

  // Evento para mostrar todas las empresas
  btnMostrarTodas.addEventListener('click', () => {
    contenedorResultado.innerHTML = '';
    mostrarDatosEnTabla(datosGlobales);
    inputBusqueda.value = '';
  });

  // Ordenar columnas Entrada y Salida al hacer click en encabezado (opcional)
  let ordenEntradaAsc = false;
  let ordenSalidaAsc = false;

  const thEntrada = document.getElementById('thEntrada');
  const thSalida = document.getElementById('thSalida');

  thEntrada.addEventListener('click', () => {
    ordenEntradaAsc = !ordenEntradaAsc;
    datosGlobales.sort((a, b) => {
      const horaA = parseHora(a.Entrada);
      const horaB = parseHora(b.Entrada);
      return ordenEntradaAsc ? horaA - horaB : horaB - horaA;
    });
    mostrarDatosEnTabla(datosGlobales);
  });

  thSalida.addEventListener('click', () => {
    ordenSalidaAsc = !ordenSalidaAsc;
    datosGlobales.sort((a, b) => {
      const horaA = parseHora(a.Salida);
      const horaB = parseHora(b.Salida);
      return ordenSalidaAsc ? horaA - horaB : horaB - horaA;
    });
    mostrarDatosEnTabla(datosGlobales);
  });
</script>

</body>
</html>

